<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wellbeing Review Request Form</title>

    <style>
        /* Global styles for body */
        body {
            font-family: "Century Gothic", Arial, sans-serif;
            margin: 20px;
            padding: 0;
            background-color: #f4f4f9;
        }

        /* Centered pre-screening section */
        #prescreening {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        /* Styling for headings (title) */
        h1, h2 {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            color: #0392A2;
        }

        /* Form container */
        form {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* Labels for the form fields */
        label {
            display: block;
            margin: 10px 0 5px;
            font-size: 18px;
            font-weight: bold;
            color: #0392A2;
        }

        /* Error message styling */
        .error {
            color: black;
            font-size: 14px;
            margin-bottom: 10px;
            display: none;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s ease; /* Smooth fade-in/out effect */
        }

            /* Custom error message styling with stars */
            .error span {
                font-weight: bold;
                color: red;
            }

        /* Center the button in pre-screening */
        #prescreening button {
            width: auto;
            padding: 10px 40px;
            background-color: #D78223;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            margin-top: 10px;
            display: inline-block;
        }

        button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #D78223;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }

            button:hover {
                background-color: #b06b1a;
            }

        /* Text input fields */
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        textarea {
            width: 100%;
            padding: 8px 12px;
            margin: 5px 0 20px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 16px;
            box-sizing: border-box;
        }

        /* Consent statement styling */
        .consent {
            font-size: 12px;
            font-style: italic;
            color: #333;
        }

        /* Flexbox container for logos */
        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

            /* Styling for both logos */
            .logo-container img {
                max-width: 100%;
                height: auto;
                object-fit: contain;
            }

        .logo {
            width: 45%;
            max-width: 300px;
            margin: 0 10px;
        }

        /* Success message styling */
        .success-message {
            text-align: center;
            padding: 20px;
        }

            .success-message h1 {
                color: #0392A2;
            }

        /* Checkbox styles */
        .checkbox-group {
            margin: 10px 0;
        }

            .checkbox-group label {
                display: block;
                background-color: #f1f1f1;
                padding: 10px;
                margin: 5px 0;
                border-radius: 5px;
                cursor: pointer;
                transition: background-color 0.3s ease;
            }

                .checkbox-group label:hover {
                    background-color: #e0e0e0;
                }

        /* Hide the "Other" contact method textarea initially */
        #otherContact {
            display: none;
        }

        /* Responsive design for mobile */
        @media (max-width: 600px) {
            form {
                padding: 15px;
            }

            h1 {
                font-size: 22px;
            }

            input[type="text"],
            input[type="email"],
            input[type="tel"],
            textarea {
                font-size: 14px;
            }

            button {
                font-size: 16px;
            }

            p.consent {
                font-size: 10px;
            }
        }
    </style>
</head>
<body>

    <!-- Pre-Screening Section -->
    <div id="prescreening">
        <h2>Eligibility Confirmation</h2>
        <p>Please confirm that your partner is currently pregnant and under the care of EPUT.</p>
        <label><input type="checkbox" id="eligibility" name="eligibility" required> Confirm</label>
        <p></p>
        <button type="button" onclick="showForm()" aria-label="Confirm eligibility and continue">Continue</button>
        <div class="error" id="prescreening-error"></div>
    </div>

    <!-- Main Form Section (Initially Hidden) -->
    <div id="form-container" style="display:none;">
        <!-- Logo Section -->
        <div class="logo-container">
            <img src="https://raw.githubusercontent.com/RCaseyP1st/Wellbeing-Review-Form/master/0ZpzuRHRXvVLxGe06x90smrbd7iaTr8sN7GzfW88.png" alt="Parents 1st Essex Logo" class="logo">
            <img src="https://raw.githubusercontent.com/RCaseyP1st/Wellbeing-Review-Form/master/OHHLogoHoizontal.png" alt="Other Half Hub Logo" class="logo">
        </div>
        <!-- Form Title -->
        <h1>Wellbeing Review Request Form</h1>

        <!-- Error message -->
        <div class="error" id="error-message"></div>

        <!-- Form Structure -->
        <form id="wellbeingForm">

            <!-- Name Field -->
            <label for="name">Name: <span class="required"><font color="red">*</font></span></label>
            <input type="text" id="name" name="name" placeholder="Your Name" required>

            <!-- Email Field -->
            <label for="email">Email Address:</label>
            <input type="email" id="email" name="email" placeholder="Your Email Address">

            <!-- Postcode Field -->
            <label for="postcode">Postcode: <span class="required"><font color="red">*</font></span></label>
            <input type="text" id="postcode" name="postcode" placeholder="Your Postcode" required>

            <!-- Phone Number Field -->
            <label for="phone">Phone Number:</label>
            <input type="tel" id="phone" name="phone" placeholder="Your Phone Number">

            <!-- Preferred Method of Contact -->
            <label>Preferred Method of Contact:</label>
            <p>You can select more than 1 option</p>
            <div class="checkbox-group">
                <label><input type="checkbox" name="contactMethod" value="Phone Call"> Phone Call</label>
                <label><input type="checkbox" name="contactMethod" value="Microsoft Teams"> Microsoft Teams</label>
                <label><input type="checkbox" name="contactMethod" value="Zoom"> Zoom</label>
                <label><input type="checkbox" name="contactMethod" value="Other" id="otherCheckbox"> Other (Please specify)</label>
            </div>
            <textarea id="otherContact" placeholder="e.g., Text Messages (SMS) or WhatsApp"></textarea>

            <!-- Consent Statement -->
            <p><strong>Consent Statement:</strong></p>
            <p class="consent">
                Are you happy for us to store the information we may talk about? We will look after any personal information that is shared with us.
                This is central to our values as an organisation. We want everyone who interacts with us to feel confident about how any personal information they share will be looked after or used. <br><br>

                You can be confident that: <br>
                • We only use personal information in the ways we need to, that is expected of us and that we have a lawful basis for. <br>
                • We respect the rights you have as an individual by having procedures in place to protect these. <br>
                • We will make it easy for you to tell us how you want us to communicate with you, including how to opt out from future communications, rectify inaccurate data or request access—and your request will be respected in a timely manner. <br>
                • We will never release your information to organisations outside Parents 1st for their marketing purposes. <br>
                • We take all reasonable care to safeguard your personal information through security policies and secure business processes. <br>
                • We will provide easy ways for you to contact us. We are always happy to answer any queries you have, at any time. <br><br>

                We will need to store the information you have given us today securely on our computer system or on paper. <br><br>

                We will need to use the information in order to recommend resources and services we think might benefit you the most. <br><br>

                How we share and store your personal information <br>
                • Your Wellbeing Coordinator will record and store information about you and the support you are receiving. This will be done using a code to protect your identity and your personal details will be stored separately. <br>
                • Your Wellbeing Coordinator will share information on a regular basis with their supervisor so as to help us provide you with the best possible service. <br>
                • For monitoring and evaluation, we may share information with partner organisations and those who provide the funding. You will not be identified by name and only numbers and statistics are given. The only exception to this is that we may provide the NHS with information that does identify you, and your baby via your NHS number. <br>
                • In any other circumstances, we will ask for your consent before we share any personal information about you or your family and tell you that we are going to do so. <br>
                • We will not ask for your consent and may not inform you that we are going to share information if there is a risk of significant or serious harm to a child or adult or if it is in the public interest not to do so. <br><br>

                If you would like more information about our confidentiality, data protection, and information sharing policies and procedures, please let us know. <br><br>

                <a href="https://www.dropbox.com/scl/fi/zgsch7s77gtat9g19bntw/Information-Sharing-Agreement-Essex-Peer-to-Parent-Network.docx?rlkey=m1bahd0u8a63j6tqpz4pknry4&st=58fot45o&dl=0">
                    Parents 1st - Information Sharing Agreement
                </a> <br><br>

                Please confirm that you understand how the information you have given us will be used, shared, and stored by us and that you give your consent for this by checking the box below.

            </p>

            <!-- Consent Checkbox -->
            <label><input type="checkbox" id="consent" name="consent" required> Consent <span class="required"><font color="red">*</font></span></label><p></p>

            <!-- Submit Button -->
            <button type="submit" aria-label="Submit Wellbeing Review Request Form">Submit</button>
        </form>
    </div>

    <!-- JavaScript Section -->
    <script>
        // Pre-screening logic
        function showForm() {
            const eligibility = document.getElementById('eligibility').checked;
            const errorMessage = document.getElementById('prescreening-error');
            if (eligibility) {
                document.getElementById('prescreening').style.display = 'none';
                document.getElementById('form-container').style.display = 'block';
            } else {
                errorMessage.innerHTML = `<span><font color="red">*</font></span> Please confirm that your partner is currently pregnant and under the care of EPUT. <span><font color="red">*</font></span>`;
                errorMessage.style.display = 'block';
            }
        }

        // Handle "Other" contact method display
        document.getElementById('otherCheckbox').addEventListener('change', function () {
            const otherContact = document.getElementById('otherContact');
            if (this.checked) {
                otherContact.style.display = 'block';
            } else {
                otherContact.style.display = 'none';
            }
        });

        // Form validation and submission
        document.getElementById('wellbeingForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent form submission
            const errorMessage = document.getElementById('error-message');
            errorMessage.style.display = 'none'; // Hide any previous error message

            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const postcode = document.getElementById('postcode').value;
            let phone = document.getElementById('phone').value;  // Let keyword to allow modification
            const consent = document.getElementById('consent').checked;
            const eligibility = document.getElementById('eligibility').checked ? 'Confirmed' : 'Not Confirmed';

            // Capture selected contact methods
            const contactMethods = document.querySelectorAll('input[name="contactMethod"]:checked');
            let selectedMethods = [];
            contactMethods.forEach((method) => {
                selectedMethods.push(method.value);
            });

            // If "Other" is selected, ensure there is input in the text box
            if (selectedMethods.includes('Other')) {
                const otherContact = document.getElementById('otherContact').value.trim();
                if (!otherContact) {
                    showError("Please specify your preferred contact method under 'Other'.");
                    document.getElementById('otherContact').focus();
                    return;
                }
            }

            // Error formatting
            function showError(message) {
                errorMessage.innerHTML = `<span><font color="red">*</font></span> ${message} <span><font color="red">*</font></span>`;
                errorMessage.style.display = 'block';
                errorMessage.style.opacity = 1; // Make the error visible with transition
            }

            // Check if at least one contact method is selected
            if (selectedMethods.length === 0) {
                showError("Please select at least one preferred method of contact.");
                return;
            }

            // Format phone number if valid
            if (phone) {
                // If the phone number starts with 0, replace it with +44
                if (phone.startsWith('0')) {
                    phone = phone.replace(/^0/, '+44');
                }

                // If the phone starts with +440, replace it with +44 (correct the invalid +440 prefix)
                if (phone.startsWith('+440')) {
                    phone = phone.replace('+440', '+44');
                }

                // Ensure the phone number matches the UK format after changes
                const phonePattern = /^(\+44)7\d{9}$/;
                if (!phonePattern.test(phone)) {
                    showError("Please provide a valid UK phone number.");
                    document.getElementById('phone').focus();
                    return;
                }
            }

            // Check if phone is required
            if (selectedMethods.includes('Phone Call') || selectedMethods.includes('Other')) {
                if (!phone) {
                    showError("If your preferred method is Phone call or Other, a valid phone number is required.");
                    document.getElementById('phone').focus();
                    return;
                }
            }

            // Regex for valid email format
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (email && !emailPattern.test(email)) {
                showError("Please provide a valid email address.");
                document.getElementById('email').focus();
                return;
            }

            // Check if email is required
            if (selectedMethods.includes('Microsoft Teams') || selectedMethods.includes('Zoom')) {
                if (!email) {
                    showError("If your preferred method is Teams or Zoom, a valid email address is required.");
                    document.getElementById('email').focus();
                    return;
                }
            }

            if (!email && !phone) {
                showError("Please provide either an email or phone number.");
                return;
            }

            // Now insert Airtable API integration code here
            // Define the Airtable API URL
            const airtableAPIURL = 'https://api.airtable.com/v0/appESMQNwIowYCCld/Wellbeing%20Review%20request%20form';

            // Define the Personal Access Token for Airtable
            const airtablePAT = 'patSU10Pp0hh1NOgo.7554e4280a027e73e31574edeff1ad25a40803a6aabe8f111f34aa0721c48d80';

            // Prepare the data for Airtable
            const airtableData = {
                records: [
                    {
                        fields: {
                            fldGQWRH8i2CYAvB1: name, // Name
                            fldOyQYkgJ8bjIAA8: email, // Email Address
                            fldQ6g39M366IJUM1: postcode, // Postcode
                            fldu236HwQ59qj94D: phone, // Phone Number
                            fld1YO1uvizsAtPof: selectedMethods.join(', '), // Preferred Method of Contact
                            fld6XWbmq0mfUrCKx: consent ? 'Yes' : 'No', // Consent
                            fldfla0da1qyZV7Kb: eligibility // Confirm Eligibility
                        }
                    }
                ]
            };


            // Set up the request options with the POST method and necessary headers
            const requestOptions = {
                method: 'POST',
                headers: {
                    "Authorization": `Bearer patSU10Pp0hh1NOgo.7554e4280a027e73e31574edeff1ad25a40803a6aabe8f111f34aa0721c48d80`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(airtableData)
            };

            // Make the POST request to Airtable
            fetch(airtableAPIURL, requestOptions)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to submit data to Airtable');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Data successfully sent to Airtable:', data);
                    // Show success message and hide the form
                    showSuccessMessage();
                })
                .catch(error => {
                    console.error('Error submitting data to Airtable:', error);
                    showError('An error occurred while submitting the form. Please try again later.');
                });

            // Only show success if Airtable request succeeds
            if (consent) {
                showSuccessMessage();
            } else {
                showError("Please give consent before submitting.");
                document.getElementById('consent').focus();
            }
        });

        // Success message and hide form
        function showSuccessMessage() {
            const form = document.getElementById('wellbeingForm');
            form.innerHTML = `
            <div class="success-message">
                <h1>Thank You!</h1>
                <p>Your form has been submitted successfully.</p>
                <p>If you provided an email address, you will receive a confirmation email shortly. Otherwise, our Fathers & Partners Wellbeing coordinator will contact you within 7 days via your selected preferred method of contact.</p>
                <button onclick="window.top.location.href='https://parents1st.org.uk/the-other-half-hub'" style="background-color: #D78223; color: white; padding: 10px; border-radius: 4px; cursor: pointer; font-size: 18px;">Return to The Other Half-Hub</button>
            </div>`;
        }

    </script>


</body>
</html>
